[[ariaid-title1]]
== Пример. Настройка хранилища файлов в FileStream внешней БД

Далее приведен пример настройки хранилища файлов Docsvision в FileStream внешней БД.

. [.ph .cmd]#Откройте страницу настроек «Внешние хранилища»:#
[loweralpha]
.. [.ph .cmd]#Откройте Консоль настройки Docsvision.#
.. [.ph .cmd]#Перейдите в раздел настроек [.ph .menucascade]#[.ph .uicontrol]*Настройки сервера* > [.ph .uicontrol]*Базы данных*#.#
.. [.ph .cmd]#Выберите настраиваемую базу данных и нажмите на кнопку [.ph .uicontrol]*Настройки*. Будет открыто окно [.keyword .wintitle]*Свойства и управление базой данных*.#
.. [.ph .cmd]#Откройте вкладку [.keyword .wintitle]*Внешние хранилища*.#
. [.ph .cmd]#Подключите к Docsvision хранилище FileStream, следуя xref:SetupStorage.adoc[инструкции]. Параметры подключения настройте следующим образом:#
[loweralpha]
.. [.ph .cmd]#В поле [.kbd .ph .userinput]`Название` введите «StorageInExternalFileStream» или любое другое название.#
.. [.ph .cmd]#В списке [.kbd .ph .userinput]`Тип` выберите значение «FileStream хранилище во внешней базе данных MS SQL».#
.. [.ph .cmd]#В списке [.kbd .ph .userinput]`Состояние` выберите значение «Online».#
.. [.ph .cmd]#В поле [.kbd .ph .userinput]`Макс. размер` оставьте значение по умолчанию (0).#
+
После того, как хранилище физически закончится, попытка добавления файла в него завершится ошибкой. Чтобы избежать этого, ограничьте размер хранилища:

[lowerroman]
... В поле [.kbd .ph .userinput]`Макс. размер` укажите примерный объем свободного места, который доступен для FileStream.
... В списке [.kbd .ph .userinput]`Состояние` выберите значение «Auto».
.. [.ph .cmd]#Флаги в блоке [.kbd .ph .userinput]`Разделы` установите по собственному усмотрению. Флаг [.ph .uicontrol]*Временный* рекомендуется снять.#
.. [.ph .cmd]#В поле [.kbd .ph .userinput]`Строка соединения` введите строку формата:#
+
[source,pre,codeblock]
----
Data Source=ServerName;Initial Catalog=DatabaseName;User ID=UserName;Password=UserPassword;Integrated Security=SSPI
----

где:

* `ServerName` замените на полное имя сервера с СУБД Microsoft SQL;
* `DatabaseName` замените на название базы данных с FileStream;
* `UserName` и `UserPassword` замените на имя и пароль пользователя, который обладает правами на работу с базой данных `DatabaseName`.

Строка подключения должна содержать данные для подключения к внешней БД (по отношению к БД Docsvision), в которую будут сохраняться бинарные данные файлов. *Не указывайте текущую или любую другую БД Docsvision – это может привести к поломке БД.*
.. [.ph .cmd]#В поле [.kbd .ph .userinput]`Папка (локальная на сервере баз данных)` введите полный путь к каталогу на сервере СУБД, на который настроен FileStream.#
.. [.ph .cmd]#При желании, измените максимальное время ожидания ответа от СУБД в поле [.kbd .ph .userinput]`Таймаут (с).`#
+
image::img/StorageFileStreamConfiguration.png[[.fig--title-label]##Figure 1. ##Пример настройки хранилища во внешнем FileStream]
. [.ph .cmd]#Создайте группу хранилищ следуя xref:SetupStorageGroup.adoc[инструкции]. Параметры группы настройте следующим образом:#
[loweralpha]
.. [.ph .cmd]#В поле [.kbd .ph .userinput]`Название` введите «ExternalFileStreamGroup» или любое другое название.#
.. [.ph .cmd]#В списке [.kbd .ph .userinput]`Режим выбора` оставьте значение по умолчанию.#
+
image::img/StorageFileStreamGroupConfiguration.png[[.fig--title-label]##Figure 2. ##Пример настройки группы хранилищ]

Хранилище можно включить в существующую группу, тогда создавать новую не требуется.
. [.ph .cmd]#Включите хранилище «StorageInExternalFileStream» в группу «ExternalFileStreamGroup» следуя xref:AddStorageToStoragesGroup.adoc[инструкции].#
. [.ph .cmd]#Настройте правила помещения файлов в группу хранилищ «ExternalFileStreamGroup» следуя xref:SetupStorageRule.adoc[инструкции]. Параметры правила настройте следующим образом:#
[loweralpha]
.. [.ph .cmd]#В поле [.kbd .ph .userinput]`Название` введите «RuleForFileStreamStorage» или любое другое название.#
.. [.ph .cmd]#В списке [.kbd .ph .userinput]`Группа` выберите значение «ExternalFileStreamGroup».#
.. [.ph .cmd]#В списке [.kbd .ph .userinput]`Тип` оставьте значение «Все файлы» или конкретизируйте параметры файлов (см. рисунок ниже), которые будут размещаться в хранилище.#
+
image::img/RuleForStorageInFileStream.png[[.fig--title-label]##Figure 3. ##Пример настройки правила для группы хранилищ «ExternalFileStreamGroup»]
. [.ph .cmd]#Повысьте приоритет использования правила «RuleForFileStreamStorage».#
[loweralpha]
.. [.ph .cmd]#Выберите правило «RuleForFileStreamStorage» в списке правил.#
.. [.ph .cmd]#Нажимайте на кнопку image:img/Buttons/ArrowUp.png[image] пока правило «RuleForFileStreamStorage» не поднимется в верх списка.#
+
image::img/StorageInFileStream.png[[.fig--title-label]##Figure 4. ##Пример настройки хранилища файлов в FileStream внешней БД]

При закрытии настроек БД согласитесь с перезапуском сервисов. Новая конфигурация файловых хранилищ применяется в течение 10 минут (по умолчанию).

*Parent topic:* xref:../topics/External_Data_Storage.adoc[Настройка внешних хранилищ Docsvision]
