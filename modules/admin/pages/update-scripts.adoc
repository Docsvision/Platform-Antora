:page-aliases: update-user-components.adoc \
update-archive-logs.adoc

= Действия при обновлении с версии 5.5.1

[#scripts]
== Обновление кода скриптов, работающих с БД {dv}

В новой версии {dv} изменился способ хранения расширенных метаданных в БД.

Теперь данные хранятся в основных таблицах секций, а не в отдельных extended-таблицах. При обновлении системы стандартным образом все существующие данные из extended-таблиц будут перенесены в основные таблицы секций, а сами extended-таблицы переименованы в `dvtable_%SECTION-ID%_extended_old_data`.

После обновления системы необходимо изменить код скриптов, обращающихся напрямую к extended-таблицам в БД, если такие функции были реализованы в Решении, например в операндах ролевой модели безопасности.

====
Если существующий скрипт содержал обращение к таблице `dvtable_\{3997861d-4ff5-496a-b8a2-d16617de91d7}_extended`, теперь нужно обращаться к таблице `dvtable_\{3997861d-4ff5-496a-b8a2-d16617de91d7}`.
====

WARNING: Данное изменение не затрагивает динамические метаданные. Скрипты, работающие с таблицами динамических секций и полей, изменять не нужно.

[#components]
== Обновление программных компонентов собственных решений

В новой версии изменился механизм проверки соответствия клиентских компонентов библиотек карточек.

.Если в Решении на базе {dv} реализованы собственные библиотеки карточек, необходимо:
. Подключить новые сборки {dv} к проекту компонента.
. Добавить в ресурсы XML-файл с описанием библиотеки карточек.
. В реализацию класса `CardLibrary` -- если .NET-сборка -- добавить переопределение метода `GetLibraryDefinition`. Метод должен возвращать описание библиотеки карточек.
+
[source,csharp]
----
   protected override string GetLibraryDefinition()
   {
     return Resources.CardLibDefinition;
   }
----
+
. Повторно собрать, протестировать работоспособность и распространить клиентский компонент библиотеки карточек.

.Для С++-реализации клиентского компонента библиотеки карточек необходимо:
. Поддержать интерфейс `ICardLibraryInfo2`.
. Изменить поведение свойства `ICardLibraryInfo.Version`.

См. реализацию в примере `netstatSolution`, в документации руководства разработчика "xref:programmer:samples:solution/snap-in/new-snap-in.adoc[]".

[#logs]
== Архивирование журналов работы

данная версия не поддерживает функцию архивирования журналов работы, с помощью которой журналы можно было архивировать во внешнюю БД. Теперь журналы могут храниться в основной или сателлитной БД.

NOTE: Функциональность очистки журналов с возможностью сохранения резервных копий поддерживается.

Если функция архивирования использовалась с целью снятия нагрузки с основной БД {dv}, воспользуйтесь альтернативным решением: используйте для хранения журналов сателлитную БД. Инструкция по переносу журналов из основной БД в сателлитную приведена в разделе "xref:console:db-log-satellite.adoc[]. При этом можно отключить периодическую очистку журналов -- menu:Журнал[Настройка бэкапа логов].

.Параметры резервного копирования и очистки журнала
image::common:log-backup.png[Параметры резервного копирования и очистки журнала]
