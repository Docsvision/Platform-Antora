[[ariaid-title1]]
== Подключение внешнего хранилища

[NOTE]
====
[.note__title]#Important:# Для работы с некоторыми типами внешних хранилищ нужна дополнительная лицензионная опция. Подробная информация приведена в данном пункте далее.

При работе с БД PostgreSQL поддерживаются не все типы хранилищ.
====

. [.ph .cmd]#Откройте страницу настроек «Внешние хранилища»:#
[loweralpha]
.. [.ph .cmd]#Откройте Консоль настройки Docsvision.#
.. [.ph .cmd]#Перейдите в раздел настроек [.ph .menucascade]#[.ph .uicontrol]*Настройки сервера* > [.ph .uicontrol]*Базы данных*#.#
.. [.ph .cmd]#Выберите настраиваемую базу данных и нажмите на кнопку [.ph .uicontrol]*Настройки*. Будет открыто окно [.keyword .wintitle]*Свойства и управление базой данных*.#
.. [.ph .cmd]#Откройте вкладку [.keyword .wintitle]*Внешние хранилища*.#
. [.ph .cmd]#Нажмите на кнопку image:img/Buttons/StorageAdd.png[image] в блоке настроек [.keyword .wintitle]*Хранилища*. Будет открыто окно настройки хранилища.#
+
image::img/CreateStorage.png[[.fig--title-label]##Figure 1. ##Окно настройки хранилища]
. [.ph .cmd]#Настройте параметры добавляемого хранилища:#
[loweralpha]
.. [.ph .cmd]#В поле [.kbd .ph .userinput]`Название` введите уникальное имя для нового хранилища.#
.. [.ph .cmd]#В списке [.kbd .ph .userinput]`Тип` выберите тип подключаемого хранилища:#
+
* «Хранилище на диске» – если данные будут храниться в каталоге в файловой системе сервера Docsvision;
* «Хранилище во внешней базе MS SQL Server» – если данные будут храниться в БД Microsoft SQL Server, не являющейся используемой БД Docsvision;
* «FileStream хранилище во внешней базе данных MS SQL Server» – если данные будут храниться в FileStream базы данных Microsoft SQL Server, которая не является текущей БД Docsvision;
* «Filestream хранилище в базе данных Docsvision» – если данные будут храниться в FileStream текущей базы данных Docsvision; *только для СУБД Microsoft SQL Server*;
* «Добавить из сборки…» – если данные будут храниться в хранилище, тип которого предоставляется выбранным компонентом (файл DLL).
+
[NOTE]
====
[.note__title]#Note:# Инструкция по разработке программного компонента для работы с хранилищем приведена в документе [.ph]#[.dfn .term]_Docsvision 5.5. Руководство программиста_#, пункт «Разработка коннектора к файловому хранилищу».
====

*Типы хранилищ «Хранилище во внешней базе MS SQL Server», «FileStream хранилище во внешней базе данных MS SQL Server» и «Filestream хранилище в базе данных Docsvision» доступны только если БД Docsvision работает под управлением Microsoft SQL Server.*
+
Обратите внимание: при использовании хранилищ «FileStream хранилище во внешней базе данных MS SQL Server» и «Filestream хранилище в базе данных Docsvision» учетным записям сервера Docsvision и файлового сервиса нужен полный доступ на папку FileStream.
+
Для СУБД Microsoft SQL Server существует ограничение на размер добавляемых файлов: не более 2 ГБ. Если в Docsvision необходимо хранить файлы больше 2 ГБ используйте «Хранилище на диске», «Filestream хранилище в базе данных Docsvision», «FileStream хранилище во внешней базе данных MS SQL Server» или другое хранилище, поддерживающее файлы такого размера. Если используется СУБД PostgreSQL аналогичное ограничение составляет 1 ГБ.
+
Помимо перечисленных типов хранилищ, в Docsvision также есть тип «Хранилище в базе данных Docsvision». Хранилище с данным типом подключено (и используется) по умолчанию, и не может быть создано или удалено.
+
Для работы с внешними хранилищами лицензия Docsvision должна содержать лицензионную опцию:

* «Docsvision Внешнее хранилище ФС» – для использования «Хранилище на диске»;
* «Docsvision Внешнее хранилище MSSQL» – для использования «Хранилище во внешней базе MS SQL Server»;
* «Docsvision Внешнее хранилище FileStream» – для использования «FileStream хранилище во внешней базе данных MS SQL Server»;
* «Docsvision Внешние файловые хранилища» – для перечисленных хранилищ и варианта «Добавить из сборки…».

*Для использования собственного типа хранилищ («Добавить из сборки…») в лицензии Docsvision должна присутствовать функция «Docsvision Модуль интеграции с произвольными файловыми хранилищами (F91DB4AB-6E40-4D04-97BB-EBABF15E1562)».*

Подключение к серверу Docsvision с настроенным внешним хранилищем, без соответствующей лицензионной опции, завершится ошибкой.
.. [.ph .cmd]#В списке [.kbd .ph .userinput]`Состояние` выберите тип подключаемого хранилища:#
+
* «Online» – стандартное состояние, при котором хранилище доступно на чтение, запись и удаление;
* «Auto» – состояние, при котором хранилище будет автоматически переведено в режим «только чтение и удаление» при достижении размера, указанного в настройке [.ph .uicontrol]*Макс. размер (Гбайт)*;
* «Disabled» – хранилище отключено (операции чтения, записи и удаления будут недоступны);
+
[NOTE]
====
[.note__title]#Note:# Измените состояние хранилища в значение «Disabled» на время проведения профилактических работ по обслуживанию хранилища.
====
+
[NOTE]
====
[.note__title]#Important:# Файлы, бинарные данные которых хранятся в хранилище с состоянием «Disabled», будут недоступны.
====
* «Read and Delete» – состояние, при котором хранилище доступно только на чтение и удаление данных;
* «Reserved» – состояние, при котором хранилище не используется, пока в его группе хранилищ не заполнены остальные хранилища – после заполнения других хранилищ группы данное хранилище будет задействовано.
.. [.ph .cmd]#Если для хранилища установлено состояние «Auto», укажите в поле [.kbd .ph .userinput]`Макс. размер (Гбайт)` максимальный размер хранилища, при достижении которого оно будет переведено в режим «только чтение и удаление». Если состояние хранилище не «Auto», данная настройка не используется.#
+
При значении по умолчанию (0 ГБ) автоматическое переключение режима хранилища осуществляться не будет.

[NOTE]
====
[.note__title]#Note:# Информация о загруженности хранилища обновляется каждые 10 минут.
====

Если хранилище включено в xref:SetDefaultStorage.adoc[группу хранилищ по умолчанию], ограничение [.kbd .ph .userinput]`Макс. размер (Гбайт)` игнорируется: если для файла не найдено других хранилищ, подходящих по правилам помещения, файл будет сохранён в хранилище из группы хранилищ по умолчанию.
.. [.ph .cmd]#В блоке настроек [.keyword .wintitle]*Разделы* установите флаги:#
+
* «Основной» – если хранилище может быть использовано для хранения бинарных данных актуальных файлов;
* «Архивный» – если хранилище может быть использовано для хранения бинарных данных архивированных файлов (файлов карточек, помещенных в архив);
* «Временный» – если хранилище может быть использовано для хранения временных бинарных данных.
+
Временное хранилище используется для временного накопления бинарных данных файлов при их добавлении в Docsvision. После завершения накопления файл будет перемещен из «временного» в «основное» хранилище.
+
[NOTE]
====
[.note__title]#Important:# Рекомендуется устанавливать флаг [.ph .uicontrol]*Временный* для всех типов хранилищ, за исключением хранилищ в БД Microsoft SQL.
====
.. [.ph .cmd]#В блоке настроек [.keyword .wintitle]*Свойства* укажите дополнительные настройки хранилища:#
+
* для типа «Хранилище на диске»:
** [.kbd .ph .userinput]`Путь` – расположение каталога в файловой системе для сохранения бинарных данных файлов;
* для типа «Хранилище во внешней базе MS SQL Server»:
** [.kbd .ph .userinput]`Строка соединения` – строка соединения с БД в формате «Data Source=ServerName;Initial Catalog=DatabaseName;User ID=UserName;Password=UserPassword»;
+
Строка подключения должна содержать данные для подключения к внешней БД (по отношению к БД Docsvision), в которую будут сохраняться бинарные данные файлов. *Не указывайте текущую или любую другую БД Docsvision – это может привести к поломке БД.*
** [.kbd .ph .userinput]`Таймаут (с)` – время ожидания ответа от сервера в секундах;
* для типа «FileStream хранилище во внешней базе данных MS SQL Server»:
** [.kbd .ph .userinput]`Строка соединения` – строка соединения с БД в формате «Data Source=ServerName;Initial Catalog=DatabaseName;User ID=UserName;Password=UserPassword»;
+
Строка подключения должна содержать данные для подключения к внешней БД (по отношению к БД Docsvision), в которую будут сохраняться бинарные данные файлов. *Не указывайте текущую или любую другую БД Docsvision – это может привести к поломке БД.*
** [.kbd .ph .userinput]`Папка` – расположение каталога на сервере СУБД для бинарных данных файлов, вытесняемых FileStream;
** [.kbd .ph .userinput]`Таймаут (с)` – время ожидания ответа от сервера в секундах;
* для типа «Filestream хранилище в базе данных Docsvision»:
** [.kbd .ph .userinput]`Папка` – расположение каталога для вытесняемых в FileStream бинарных данных файлов на сервере СУБД Microsoft SQL Server;
* для типа «Добавить из сборки…» список дополнительных параметров определяется собственной реализацией типа хранилища.
. [.ph .cmd]#Нажмите на кнопку [.ph .uicontrol]*ОК*. Хранилище будет добавлено в список хранилищ.#
+
Новая конфигурация будет применена в течение 10 минут.
. [.ph .cmd]#xref:AddStorageToStoragesGroup.adoc[Включите хранилище в группу хранилищ].#

* Для изменения настроек хранилища: выберите его в списке [.keyword .wintitle]*Хранилища* и нажмите на кнопку image:img/Buttons/StorageEdit.png[image]. Тип хранилища не может быть изменен.
* Для удаления хранилища: выберите его в списке [.keyword .wintitle]*Хранилища* и нажмите на кнопку image:img/Buttons/StorageDelete.png[image]. Хранилище также будет удалено из всех групп хранилищ. Стандартное хранилище «Databases» (приведено название по умолчанию) не может быть удалено.
+
[NOTE]
====
[.note__title]#Important:# Перед удалением хранилища убедитесь, что данные, которые в нем размещены, не используются в карточках, т.к. после удаления (хранилища) файлы, которые хранились в нем, будут недоступны.
====

*Parent topic:* xref:../topics/External_Data_Storage.adoc[Настройка внешних хранилищ Docsvision]
