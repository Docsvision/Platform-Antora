:elastic:

= Подключить полнотекстовый поиск Elasticsearch

[WARNING]
====
Лицензия {dv} должна содержать опцию _{dv} Внешний полнотекстовый поиск ElasticSearch_, иначе использование системы ElasticSearch приведет к ошибке сервера {dv}.
====

. xref:search-elastic.adoc[Установите систему полнотекстового поиска ElasticSearch].
include::partial$excerpts.adoc[tags=openFullText]
. Нажмите кнопку *Добавить базу данных*, чтобы открыть окно добавления БД к сервису полнотекстового индексирования.
+
TIP: Чтобы ElasticSearch корректно искал по базе данных Microsoft SQL, в настройках индексации добавьте локаль отличную от нейтральной. Например, русский язык.
+
.Окно добавления БД к сервису полнотекстового индексирования
image::AddDbToFulltextStartPage.png[Окно добавления БД к сервису полнотекстового индексирования]
+
. В списке _Название базы_ выберите подключаемую БД {dv}, установите флаг `*Использовать внешний полнотекстовый поиск (Elasticsearch)*`. Нажмите *Далее*, чтобы продолжить настройку.
+
В списке отображаются БД, xref:console-db.adoc[подключенные] к данному серверу {dv}.
+
. Настройте параметры подключения БД к системе полнотекстового поиска.
+
.Окно параметров подключения БД к системе полнотекстового поиска
image::AddDbToElasticConfig.png[Окно параметров подключения БД к системе полнотекстового поиска]
+
****
.. В поле _Elasticsearch url_ укажите адрес системы Elasticsearch в следующем формате: `\http://elastic.company.com:9200`.
+
.. Поле _Строка подключения к базе_ содержит неизменяемую строку подключения к БД, которая подключается к сервису полнотекстового индексирования.
.. В поле _Сервер DocsVision_ должна быть указана строка подключения к службе *{sss}* следующего вида: `ConnectAddress=http://company.com/DocsVision/StorageServer/StorageServerService.asmx`.
+
По умолчанию в поле отображается строка подключения к текущему серверу {dv}.
+
[#repeat]
.. Нажмите кнопку *Тест соединений*. Строка подключения будет выделена красным, если подключение не удалось. Если тест завершился с ошибкой, проверьте корректность параметров.
.. Нажмите кнопку *Далее*.
+
TIP: Если введены неверные данные, кнопка *Далее* будет заблокирована. Исправьте настройки и <<repeat,повторите>> п d.
****
+
. В следующем окне настройте параметры индексирования карточек.
+
.Окно настройки параметров индексирования карточек
image::AddDbToElasticConfigCards.png[Окно настройки параметров индексирования карточек]
+
****
.. Установите флаг индексирования у отдельных полей карточек. Типы карточек выбранных полей будут добавлены в список _Индексируемые карточки_.
+
include::partial$excerpts.adoc[tags=cantSelect]
+
.. Если требуется, измените количество https://www.elastic.co/guide/en/elasticsearch/reference/5.5/_basic_concepts.html#getting-started-shards-and-replicas[шардов] (shards) в индексе. Для этого выберите *тип* карточек в списке типов, и измените значение в поле _Количество фрагментов индекса_.
+
Для каждого типа карточек создается отдельный индекс. Количество фрагментов в индексе регулируется указанной настройкой.
+
.. Если требуется, включите анализатор текста для полей карточек. Для этого выберите поле карточки в списке карточек, и установите флаг `*Анализировать поле*`.
+
Анализатор -- дополнительный компонент Elasticsearch. Анализатор формирует полнотекстовые индексы с учетом морфологии языка.
+
Также при выборе поля карточки, справа отобразится информация о поле:
+
* _Тип поля_.
* _Доступно для индексирования_ -- по полю может быть выполнен поиск.
+
[#deleteSource]
.. Установите флаг `*Удалять первичные данные файлов после обработки*`, чтобы индексируемые файлы автоматически удалялись из базы Elasticsearch.
+
.В Elasticsearch существует два набора данных:
* RawContent -- исходные данные файлов, переданные из {dv}.
+
Исходные данные не используются в поиске, по ним формируются обработанные данные (CleanContent).
+
* CleanContent -- обработанные данные, сформированные из RawContent.
+
Обработанные данные используются в полнотекстовом поиске.
+
Если флаг `*Удалять первичные данные файлов после обработки*` активен, данные RawContent будут автоматически удаляться после формирования данных CleanContent.
+
.. Нажмите кнопку *Далее*.
****
+
. В следующем окне настройте параметры индексирования справочников.
+
.Окно настройки параметров индексирования справочников
image::AddDbToElasticConfigDictionaries.png[Окно настройки параметров индексирования справочников]
+
****
.. Установите флаг индексирования у отдельных полей справочников.
+
include::partial$excerpts.adoc[tags=cantSelect]
+
Для поля, содержащего данные сложного вида, например, _Номер_ необходимо активировать флаг `*Анализировать поле*`. Когда флаг активен, будет доступен поиск как по части текста (с ограничениями), так и по полному совпадению. Если анализатор не выключен, будет срабатывать нечёткий поиск.
+
.Особенности индексирования данных сложного вида
image::elasticIndexing.png[Особенности индексирования данных сложного вида]
+
.. Нажмите кнопку *Далее*.
****
+
. Нажмите *Завершить*, чтобы подключить БД к сервису полнотекстового индексирования с текущими настройками.
+
****
База данных будут добавлена в список баз данных, использующих сервис полнотекстового индексирования.
****
+
. Включите индексирование добавленной базы данных.
+
include::partial$indexingProperties.adoc[]
