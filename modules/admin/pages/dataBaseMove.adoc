= Перенос БД {dv} между серверами {dv}

Перенос базы данных между серверами {dv} может потребоваться, если необходимо подключить БД к другому серверу {dv}, но в лицензии {dv} отсутствует опция "{dv} Concurrent Servers", которая позволяет работать с одной БД нескольким серверам {dv}. При попытке подключить БД ко второму серверу {dv} возникнет предупреждение:

image::Database_Wizard_Parallel_Servers.png[Диалоговое окно "Внимание: параллельные серверы"]

[NOTE]
====
Перенесенная БД не будет доступна на сервере {dv}, с которого она была перемещена.
====

Перед переносом необходимо определить, является ли она единственной на сервере {dv}, с которого БД перемещается:

* База данных не является единственной базой данных на сервере {dv} -- отключите БД от сервера {dv}, следуя инструкции по xref:dataBaseDetach.adoc[отключению БД].
* База данных является единственной базой данных на этом сервере {dv} -- непосредственное отключение базы данных невозможно. Выполните следующие действия, чтобы подготовить БД к переносу:
. Убедитесь, что пользователи не работают с перемещаемой БД.
. Остановите все сервисы {dv}, работающие на этом сервере:
** {dv} 5.5 StorageServer;
** {dv} 5.5 Full-Text Indexing Service;
** {dv} 5.5 WorkflowServer.
. Остановите IIS.
. Очистите (в SQL Server Management Studio) сервисные таблицы сессий и серверов Workflow командой:
+
[source]
----
DELETE [dbo].[dvsys_sessions]
DELETE [dbo].[dvsys_workflow_services]
----
+
Если команды вызвали ошибку `The ALTER TABLE statement conflicted with the                   FOREIGN KEY constraint "fk_SessionID_dvsys_search_results". The conflict occurred                   in database "...", table "dbo.dvsys_sessions", column 'SessionID'`, удалите записи из ссылающихся таблиц, у которых нет внешнего ключа с каскадным удалением. Узнать имена ссылающихся таблиц можно с помощью запроса:

[source]
----
select OBJECT_NAME(tColumns.parent_object_id) ReferencingTable, OBJECT_NAME(tColumns.constraint_object_id) 
ReferencingKey, tKeys.delete_referential_action_desc [OnDeleteAction] from sys.foreign_key_columns tColumns 
join sys.foreign_keys tKeys ON tColumns.constraint_object_id = tKeys.[object_id] 
where tColumns.referenced_object_id = OBJECT_ID('[dbo].[dvsys_sessions]') 
----

После отключения БД от одного сервера, её можно подключить к другому серверу, следуя инструкции xref:dataBaseConnect.adoc[Подключение к серверу {dv} существующей базы данных].
