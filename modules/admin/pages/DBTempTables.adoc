= Настройка размещения служебных таблиц

Администратор может настроить место размещения служебных таблиц, используемых сервером {dv} для хранения временных данных (внутренних курсоров, курсоров для работы с файлами и иконками, промежуточных данных представлений, результатов поисковых запросов и др.).

В качестве хранилища служебных таблиц могут быть выбраны:

* БД {dv};
* xref:DBExternalTables.adoc[сателлитная] база данных, предназначенная для системных таблиц (`{Название БД {dv}}_Metadata`);
* база данных "tempdb";
* или "таблица в памяти" (описание на сайте Microsoft: https://docs.microsoft.com/ru-ru/sql/relational-databases/in-memory-oltp/in-memory-oltp-in-memory-optimization).

Использование внешних баз данных для хранения служебных таблиц позволяет облегчить обслуживание основной базы {dv}, сократить время на создание её резервных копий и т.п.

Чтобы настроить размещение служебных таблиц:

* при создании/подключении БД: нажмите на кнопку *Настройки* на странице настройки параметров создания БД;
+
image::openAdvancedConfigButton.png[Кнопка для открытия панели настроек создания/подключения БД]
* в параметрах подключенной базы данных: откройте страницу xref:ControlPanelMetadata.adoc[Метаданные] настроек БД, и нажмите на кнопку *Настройки*;

Будет открыто окно *Настройка генерации скрипта*.

image::changeDbGenScript.png[Настройка генерации скрипта]

Настройка размещения служебных таблиц осуществляется с помощью следующих параметров:

* *ChangedObjectDataBaseType* -- определяет расположение временных таблиц с изменениями объектов;
* *CursorDataBaseType* -- определяет расположение временных таблиц с внутренними курсорами;
* *FileCursorDataBaseType* -- определяет расположение временных таблиц с файловыми курсорами;
* *IconDataBaseType* -- определяет расположение временных таблиц с иконками;
* *KeysetDataBaseType* -- определяет расположение временных таблиц представлений;
* *SearchDataBaseType* -- определяет расположение временных таблиц с данными поисковых запросов.

Для каждой служебной таблицы можно индивидуально указать место размещения, которое может принимать одно из следующих значений:

* "UseDefaultOrCurrent" -- использовать текущее значение или значение по умолчанию;
+
[NOTE]
====
Значения по умолчанию для новой БД и БД {dv} версии 5.4: таблица с файловыми курсорами будет храниться в собственной БД {dv}, остальные временные таблицы в базе данных "tempdb".
====
* "UseOwnDatabase" -- использовать БД {dv};
* "UseOuterDatabase" -- использовать сателлитную БД, предназначенную для системных таблиц (`{Название БД {dv}}_Metadata`);
+
[NOTE]
====
Если сателлитная БД `{Название БД {dv}}_Metadata` не используется (параметр `UseOuterMetadata` в значении "False"), она будет создана.
====
* "UseTemparyDatabase" -- использовать временную базу данных "tempdb";

Для служебной таблицы *ChangedObjectDataBaseType* также доступны варианты:

* "InMemoryTableOwnDatabase" -- "таблица в памяти" SQL-сервера;
* "InMemoryTableOwnDatabaseNotPersistData" -- "таблица в памяти" SQL-сервера без сохранения данных при перезапуске SQL Server.

[NOTE]
====
При изменении расположения служебных таблиц (после завершения первоначальной настройки {dv}) будет запущена хранимая процедура "ObjectValidation". Максимальное время выполнения данной процедуры -- 3 часа. Если при сохранения возникает ошибка превышения таймаута, задайте большее значение на странице xref:DatabaseConfigurationPagesManagement.adoc[Управление] в параметре "Таймаут". При установке значения действует следующее правило: если установлено значение 30 минут или меньше, то для хранимой процедуры "ObjectValidation". действует ограничение -- 3 часа, иначе -- используется установленное в параметре "Таймаут" значение. После завершения работы процедуры рекомендуется вернуть для настройки "Таймаут" значение по умолчанию -- 600 секунд.
====

