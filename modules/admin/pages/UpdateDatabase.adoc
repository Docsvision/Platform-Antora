[[ariaid-title1]]
== Обновление базы данных

Версия базы данных Docsvision должна соответствовать версии сервера Docsvision. Чтобы обновить БД до версии сервера, выполните следующие действия.

[NOTE]
====
[.note__title]#Прим.:# При обновлении БД Docsvision индексы, добавленные самостоятельно, будут удалены.
====

[[task_jxb_2gm_fp__steps_cgn_4fm_fp]]
. [.ph .cmd]#Откройте xref:DatabasesMaster.adoc[мастер БД Docsvision].#
+
image::img/DatabaseMaster.png[[.fig--title-label]##Рис. 1. ##Мастер БД Docsvision]
. [.ph .cmd]#Выберите в списке обновляемую базу данных.#
. [.ph .cmd]#Выберите режим «Обновить выбранную в списке базу данных». Нажмите [.ph .uicontrol]*Далее*.#
. [.ph .cmd]#Выберите библиотеки карточек, которые должны быть обновлены. Нажмите [.ph .uicontrol]*Далее*.#
+
image::img/updateDBCardLibs.png[[.fig--title-label]##Рис. 2. ##Выбор обновляемых библиотек карточек]
+
Библиотеки карточек, версии которых отличаются от установленных в БД версий, будут автоматически выбраны (данные библиотеки могут быть обновлены). Если версия загружаемой библиотеки карточек соответствует версии библиотеки в БД или файлы библиотеки карточек отсутствуют в каталоге сервера Docsvision ([.ph .filepath]`C:\Program Files (x86)\Docsvision\Platform\5.5\Tools\Database`), возможность выбора таких библиотек карточек будет заблокирована (строчки серого цвета), флаг – снят.
+
В строке «Пользовательские метаданные» указано была ли модифицирована (добавлены пользовательские метаданные) установленная в БД библиотека карточек.
+
В строке с режимом обновления БД указывается выбранный платформой Docsvision вариант обновления БД:

* «полный режим» – будет выполнено полное обновление выбранных библиотек карточек и версии клиентских компонентов;
* «лёгкий режим» – будет обновлена только информация о версии клиентских компонентов.
+
Если для обновления выбрано несколько библиотек карточек и одна из них требует полного обновления, то в строке с режимом обновления будет указано «База данных будет обновлена в полном режиме». При этом каждая библиотека обновляется в требуемом ей режиме (лёгком или полном).
+
[NOTE]
====
[.note__title]#Прим.:# Принцип определения требуемого режима обновления:

* если изменилась версия генератора схем карточек – все библиотеки карточек будут обновлены в полном режиме;
* если изменилась схема библиотеки карточек, но не изменилась схема её карточек – будут установлены/обновлены только расширенные отчёты и скрипты данной библиотеки карточек;
* если изменилась схема одной или нескольких карточек библиотеки карточек – библиотека карточек будет обновлена полностью;
* если изменений генератора, схемы библиотеки карточек и схем карточек не было – обновление будет выполнено в лёгком режиме.
====
. [.ph .cmd]#Подтвердите настройки, которые будут использованы для обновления базы данных. Нажмите [.ph .uicontrol]*Далее*.#
+
image::img/DatabaseUpdate_1.png[[.fig--title-label]##Рис. 3. ##Мастер БД Docsvision в режиме создания базы данных]
+
Значение [.ph .uicontrol]*Ожидать завершения атомарной операции на SQL Server (сек)* определяет максимальное время ожидания завершения отдельного этапа (операции) процедуры создания/подключения БД. Если операция не будет выполнена за указанное время, она завершится с ошибкой.

[NOTE]
====
[.note__title]#Прим.:# Параметр [.ph .uicontrol]*Ожидать завершения атомарной операции на SQL Server (сек)* не ограничивает время выполнения пользовательских операций (при работе в Windows-клиенте) – будет применяться стандартное ограничение 600 секунд.
====
. [.ph .cmd]#Утвердительно ответьте на запрос об обновлении БД. Дождитесь завершения обновления БД и загрузки SQL объектов.#
+
[NOTE]
====
[.note__title]#Важное замечание:# Обновление базы данных может занять продолжительное время. Пользователи и сервисы, использующие эту базу данных, будут отключены, и не смогут подключаться к ней до окончания процесса обновления.
====
+
Если процесс обновления базы данных был прерван по таймауту, увеличьте значение настройки [.kbd .ph .userinput]`Ожидать завершения атомарной операции на SQL Server (сек)` и повторите процедуру обновления.
. [.ph .cmd]#Выберите модули Docsvision, настройки которых должны быть обновлены в БД, и нажмите кнопку [.ph .uicontrol]*Завершить*. При этом существующие в БД стандартные настройки выбранных модулей будут перезаписаны.#
+
image::img/DatabaseCreate_5.png[[.fig--title-label]##Рис. 4. ##Выбор модулей, настройки которых будут загружены в БД]
+
Возможность выбора модулей, настройки которых не нуждаются в обновлении (версия в БД является актуальной), будет заблокирована.

image::img/DatabaseCreate_5WithDisabled.png[[.fig--title-label]##Рис. 5. ##Список модулей с актуальной версией настроек модуля «Почтовый клиент»]
. [.ph .cmd]#Дождитесь завершения загрузки настроек.#
. [.ph .cmd]#Перезапустите сервисы Docsvision для применения новых параметров.#
+
image::img/ConfigMaster_7.png[[.fig--title-label]##Рис. 6. ##Запрос на перезапуск сервисов Docsvision]

Чтобы вернуть базу данных в рабочее состояние, нужно:

. Включить полнотекстовый поиск (перед обновлением поиск автоматически отключается).
. Пересоздать все индексы, которые были добавлены при внедрении системы.
. Если в базу данных при внедрении системы были добавлены триггеры, то после обновления базы данных их потребуется создать повторно.

*На уровень выше:* xref:../topics/Database.adoc[Управление базами данных]
