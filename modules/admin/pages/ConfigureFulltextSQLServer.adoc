= Подключение полнотекстового поиска Microsoft SQL Server

. Если требуется индексировать содержимое файлов PDF и Microsoft Office, выполните инструкцию, приведенную в пункте xref:EnablePDFFulltextSearch.adoc[Настройка индексирования файлов PDF и Microsoft Office].
. Откройте _{cns}_.
. Перейдите к элементу *модули расширения* > *Сервис полнотекстового поиска*#.
. Нажмите кнопку *Добавить базу данных*. Будет открыто окно добавления БД к сервису полнотекстового индексирования.
+
image::AddDbToFulltextStartPage.png[Окно добавления БД к сервису полнотекстового индексирования]
. В списке *Название базы* выберите подключаемую БД Microsoft SQL Server. Нажмите *Далее* для продолжения настройки.
+
В списке баз данных отображаются БД, xref:Server_Settings_Databases.adoc[подключенные] к данному серверу {dv}.
. Настройте параметры подключения БД к системе полнотекстового поиска.
+
image::AddDbToFulltextIndexingConfig.png[Окно настройки параметров подключения БД к системы полнотекстового поиска]
[loweralpha]
.. Если требуется, в поле *Полнотекстовое хранилище* измените путь к каталогу файлов полнотекстовой группы. В поле должен быть указан локальный каталог на сервере баз данных.
+
Путь к хранилищу файлов полнотекстовой группы можно указать только при подключении БД к сервису полнотекстового индексирования. После завершения настройки путь можно изменить только следуя рекомендациям Microsoft: https://docs.microsoft.com/ru-ru/sql/t-sql/statements/alter-database-transact-sql-file-and-filegroup-options?view=sql-server-ver15 и https://docs.microsoft.com/ru-ru/sql/relational-databases/databases/move-user-databases?view=sql-server-ver15.
+
При повторном подключении БД к сервису полнотекстового индексирования в настройке *Полнотекстовое хранилище* будет указан путь, который был указан до отключения этой БД от сервиса. Изменить путь можно только следую рекомендациям Microsoft, ссылки на которые приведены выше.
.. Поле *Строка подключения к базе* содержит неизменяемую строку подключения к БД, которая подключается к сервису полнотекстового индексирования.
.. В поле *Сервер {dv}* должна быть указана строка подключения к службе сервера {dv}.
+
Строка подключения имеет следующий вид:

[source]
----
ConnectAddress=http://company.com/DocsVision/StorageServer/StorageServerService.asmx
----
+
По умолчанию в поле отображается строка подключения к текущему серверу {dv}.
.. Если требуется установите флаг *Использовать внешнюю базу для карточек* и/или *Использовать внешнюю базу для файлов*. В этом случае данные индексирования будут размещаться во внешней БД, вместо БД {dv}.
+
После установки флага использования внешней БД станут доступны для редактирования настройки:

* *Создавать внешнюю базу по умолчанию* -- данные полнотекстового индексирования будут сохраняться в базу данных "[Название БД {dv}]_FT", которая будет создана на сервере БД с базой данных {dv};
* *Использовать существующую базу* -- данные полнотекстового индексирования будут сохраняться в любую существующую базу данных (нажмите кнопку *…* и укажите данные для подключения к БД).
.. Добавьте языки, для которых полнотекстовые индексы будут строиться с учетом морфологии языка.
+
[lowerroman]
... Нажмите кнопку *Добавить*. Будет открыто диалоговое окно выбора языка.
... Выберите индексируемый язык и нажмите кнопку *ОК*. Язык будет добавлен в список *Полнотекстовые языки*.
+
В обычном случае, достаточно добавить русский язык. SQL Server должен поддерживать полнотекстовую индексацию с учетом морфологии выбранных языков.
.. Нажмите *Далее* для продолжения настройки.
. В следующем окне, установите переключатель в значение "Xml индексирование (рекомендуется)" и выберите индексируемые типы карточек (установите флажок). При необходимости, для каждого типа карточке можно изменить набор индексируемых полей. Нажмите *Далее* для продолжения настройки.
+
image::AddDbToFulltextIndexingConfigCards.png[Окно выбора индексируемых типов карточек]
. В следующем окне, установите переключатель в значение "Индексировать оперативные файлы" или "Индексировать оперативные и архивные файлы" (также будут индексироваться файлы архивных карточек), и выберите типы индексируемых файлов (установите флажок). Нажмите *Далее* для продолжения настройки.
+
image::AddDbToFulltextIndexingConfigFiles.png[Окно выбора индексируемых типов файлов]
. Настройте параметры индексирования и обновления индексов.
+
image::AddDbToFulltextIndexingCommonConfig.png[Окно настройки параметров индексирования]
+
* *Максимальный размер транзакции* -- определяет максимальный размер пакета с данными (карточек и файлов), передаваемых за один раз для индексирования в SQL Server;
* *Период инициализации индексов* -- определяет промежуток времени, в течение которого создаются индексы для новых данных и данных, индексация которых не выполнена. Если первое значение больше второго, в период индексации включается также следующий день;
* *Обновлять индексы один раз в* и *Обновлять индексы каждые* -- определяют периодичность обновления существующих индексов.
. В следующем окне будут представлены итоговые настройки индексирования. Нажмите *Завершить*, чтобы подключить БД к сервису полнотекстового индексирования с текущими настройками. База данных будут добавлена в список баз данных, использующих сервис полнотекстового индексирования.
. Включите индексирование добавленной базы данных.
[loweralpha]
.. Выберите добавленную базу данных в списке и нажмите кнопку *Свойства индексирования*. Будет открыто окно настройки индексирования БД.
+
image::AddDbToFulltextIndexingEnable.png[Настройки индексирования базы данных]
.. Установите переключатель *Статус индексирования* в значение "Включено".
.. Нажмите кнопку *Применить* для сохранения изменений.
+
В списке индексируемых БД, у настраиваемой БД значение в колонке "Индексирование" изменится на "Да".
. Перезапустите сервер {dv} (пул приложений "DocsVision" или IIS) и сервис полнотекстового индексирования (службу "{dv} 5.5 Full-text indexing Service").

* xref:EnablePDFFulltextSearch.adoc[Настройка индексирования файлов PDF и Microsoft Office].
