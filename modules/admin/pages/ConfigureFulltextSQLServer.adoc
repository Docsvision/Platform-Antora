[[ariaid-title1]]
== Подключение полнотекстового поиска Microsoft SQL Server

. [.ph .cmd]#Если требуется индексировать содержимое файлов PDF и Microsoft Office, выполните инструкцию, приведенную в пункте xref:EnablePDFFulltextSearch.adoc[Настройка индексирования файлов PDF и Microsoft Office].#
. [.ph .cmd]#Откройте Консоль настройки Docsvision.#
. [.ph .cmd]#Перейдите к элементу [.ph .menucascade]#[.ph .uicontrol]*Модули расширения* > [.ph .uicontrol]*Сервис полнотекстового поиска*#.#
. [.ph .cmd]#Нажмите кнопку [.ph .uicontrol]*Добавить базу данных*. Будет открыто окно добавления БД к сервису полнотекстового индексирования.#
+
image::img/AddDbToFulltextStartPage.png[[.fig--title-label]##Figure 1. ##Окно добавления БД к сервису полнотекстового индексирования]
. [.ph .cmd]#В списке [.ph .uicontrol]*Название базы* выберите подключаемую БД Microsoft SQL Server. Нажмите [.ph .uicontrol]*Далее* для продолжения настройки.#
+
В списке баз данных отображаются БД, xref:Server_Settings_Databases.adoc[подключенные] к данному серверу Docsvision.
. [.ph .cmd]#Настройте параметры подключения БД к системе полнотекстового поиска.#
+
image::img/AddDbToFulltextIndexingConfig.png[[.fig--title-label]##Figure 2. ##Окно настройки параметров подключения БД к системы полнотекстового поиска]
[loweralpha]
.. [.ph .cmd]#Если требуется, в поле [.ph .uicontrol]*Полнотекстовое хранилище* измените путь к каталогу файлов полнотекстовой группы. В поле должен быть указан локальный каталог на сервере баз данных.#
+
Путь к хранилищу файлов полнотекстовой группы можно указать только при подключении БД к сервису полнотекстового индексирования. После завершения настройки путь можно изменить только следуя рекомендациям Microsoft: https://docs.microsoft.com/ru-ru/sql/t-sql/statements/alter-database-transact-sql-file-and-filegroup-options?view=sql-server-ver15 и https://docs.microsoft.com/ru-ru/sql/relational-databases/databases/move-user-databases?view=sql-server-ver15.
+
При повторном подключении БД к сервису полнотекстового индексирования в настройке [.ph .uicontrol]*Полнотекстовое хранилище* будет указан путь, который был указан до отключения этой БД от сервиса. Изменить путь можно только следую рекомендациям Microsoft, ссылки на которые приведены выше.
.. [.ph .cmd]#Поле [.ph .uicontrol]*Строка подключения к базе* содержит неизменяемую строку подключения к БД, которая подключается к сервису полнотекстового индексирования.#
.. [.ph .cmd]#В поле [.ph .uicontrol]*Сервер Docsvision* должна быть указана строка подключения к службе сервера Docsvision.#
+
Строка подключения имеет следующий вид:

[source,pre,codeblock]
----
ConnectAddress=http://company.com/DocsVision/StorageServer/StorageServerService.asmx
----
+
По умолчанию в поле отображается строка подключения к текущему серверу Docsvision.
.. [.ph .cmd]#Если требуется установите флаг [.ph .uicontrol]*Использовать внешнюю базу для карточек* и/или [.ph .uicontrol]*Использовать внешнюю базу для файлов*. В этом случае данные индексирования будут размещаться во внешней БД, вместо БД Docsvision.#
+
После установки флага использования внешней БД станут доступны для редактирования настройки:

* [.ph .uicontrol]*Создавать внешнюю базу по умолчанию* – данные полнотекстового индексирования будут сохраняться в базу данных «[Название БД Docsvision]_FT», которая будет создана на сервере БД с базой данных Docsvision;
* [.ph .uicontrol]*Использовать существующую базу* – данные полнотекстового индексирования будут сохраняться в любую существующую базу данных (нажмите кнопку [.ph .uicontrol]*…* и укажите данные для подключения к БД).
.. [.ph .cmd]#Добавьте языки, для которых полнотекстовые индексы будут строиться с учетом морфологии языка.#
+
[lowerroman]
... Нажмите кнопку [.ph .uicontrol]*Добавить*. Будет открыто диалоговое окно выбора языка.
... Выберите индексируемый язык и нажмите кнопку [.ph .uicontrol]*ОК*. Язык будет добавлен в список [.ph .uicontrol]*Полнотекстовые языки*.
+
В обычном случае, достаточно добавить русский язык. SQL Server должен поддерживать полнотекстовую индексацию с учетом морфологии выбранных языков.
.. [.ph .cmd]#Нажмите [.ph .uicontrol]*Далее* для продолжения настройки.#
. [.ph .cmd]#В следующем окне, установите переключатель в значение «Xml индексирование (рекомендуется)» и выберите индексируемые типы карточек (установите флажок). При необходимости, для каждого типа карточке можно изменить набор индексируемых полей. Нажмите [.ph .uicontrol]*Далее* для продолжения настройки.#
+
image::img/AddDbToFulltextIndexingConfigCards.png[[.fig--title-label]##Figure 3. ##Окно выбора индексируемых типов карточек]
. [.ph .cmd]#В следующем окне, установите переключатель в значение «Индексировать оперативные файлы» или «Индексировать оперативные и архивные файлы» (также будут индексироваться файлы архивных карточек), и выберите типы индексируемых файлов (установите флажок). Нажмите [.ph .uicontrol]*Далее* для продолжения настройки.#
+
image::img/AddDbToFulltextIndexingConfigFiles.png[[.fig--title-label]##Figure 4. ##Окно выбора индексируемых типов файлов]
. [.ph .cmd]#Настройте параметры индексирования и обновления индексов.#
+
image::img/AddDbToFulltextIndexingCommonConfig.png[[.fig--title-label]##Figure 5. ##Окно настройки параметров индексирования]
+
* [.ph .uicontrol]*Максимальный размер транзакции* – определяет максимальный размер пакета с данными (карточек и файлов), передаваемых за один раз для индексирования в SQL Server;
* [.ph .uicontrol]*Период инициализации индексов* – определяет промежуток времени, в течение которого создаются индексы для новых данных и данных, индексация которых не выполнена. Если первое значение больше второго, в период индексации включается также следующий день;
* [.ph .uicontrol]*Обновлять индексы один раз в* и [.ph .uicontrol]*Обновлять индексы каждые* – определяют периодичность обновления существующих индексов.
. [.ph .cmd]#В следующем окне будут представлены итоговые настройки индексирования. Нажмите [.ph .uicontrol]*Завершить*, чтобы подключить БД к сервису полнотекстового индексирования с текущими настройками. База данных будут добавлена в список баз данных, использующих сервис полнотекстового индексирования.#
. [.ph .cmd]#Включите индексирование добавленной базы данных.#
[loweralpha]
.. [.ph .cmd]#Выберите добавленную базу данных в списке и нажмите кнопку [.ph .uicontrol]*Свойства индексирования*. Будет открыто окно настройки индексирования БД.#
+
image::img/AddDbToFulltextIndexingEnable.png[[.fig--title-label]##Figure 6. ##Настройки индексирования базы данных]
.. [.ph .cmd]#Установите переключатель [.ph .uicontrol]*Статус индексирования* в значение «Включено».#
.. [.ph .cmd]#Нажмите кнопку [.ph .uicontrol]*Применить* для сохранения изменений.#
+
В списке индексируемых БД, у настраиваемой БД значение в колонке «Индексирование» изменится на «Да».
. [.ph .cmd]#Перезапустите сервер Docsvision (пул приложений «DocsVision» или IIS) и сервис полнотекстового индексирования (службу «Docsvision 5.5 Full-text indexing Service»).#

* *xref:../topics/EnablePDFFulltextSearch.adoc[Настройка индексирования файлов PDF и Microsoft Office]* +

*Parent topic:* xref:../topics/Preparing_to_Work_Configure_FullText_Search.adoc[Настройка полнотекстового поиска]
