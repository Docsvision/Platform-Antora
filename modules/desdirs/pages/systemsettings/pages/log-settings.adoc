= Настройки журнала

Система {dv} фиксирует события, связанные с действиями пользователей, в трёх типах журналов:

- <<securityLog,Журнал безопасности>> -- события, связанные с безопасностью.
- <<system-log,Журнал системы>> -- операции с карточками и файлами.
- <<application-log,Журнал приложения>> -- события отдельных Приложений {dv}.

[NOTE]
====
Журналы доступны в программе РМА, см. _Руководство пользователя модуля {wincl}_, пункт _Журналы сообщений_.
====

Администратор {dv} может изменить список протоколируемых операций для каждого типа журналов. По умолчанию протоколируются все возможные операции.

[#securityLog]
== Сообщения системы безопасности

.В журнале безопасности фиксируется:
- Все попытки доступа к объектам системы.
- Вход и выход пользователя из системы.
- Операции принудительного закрытия сессии администратором.

Проверка прав доступа производится на стороне сервера и клиента. Если при этом на сервере генерируется ошибка, она будет записана в системный журнал.

.Чтобы настроить журнал сообщений системы безопасности:
. В области _Категории_ выберите ветку menu:Настройки журнала[Безопасность].
+
В центральной части окна будет расположено дерево операций, доступных для протоколирования в журнале безопасности.
+
.Настройки сообщений журнала системы безопасности
image::logs-security.png[Настройки сообщений журнала системы безопасности]
+
. Установите флаги напротив операций, которые должны фиксироваться в журнале. Название операции соответствуют действию, выполняемому серверной частью системы {dv}.
include::partial$excerpts.adoc[tags=restart]

[#system-log]
== Системные сообщения

.В журнале системных сообщений фиксируется:
- Низкоуровневые действия над карточками, строками, файлами и другими объектами системы.
- Ошибки, предупреждения и информационные сообщения системы.

.Чтобы настроить журнал системных сообщений, выполните следующие действия:
. В области _Категории_ выберите ветку menu:Настройки журнала[Система].
+
В центральной части окна будет расположено дерево операций, доступных для протоколирования в журнале системных сообщений.
+
.Настройки системных сообщений журнала
image::logs-system.png[Настройки системных сообщений журнала]
+
. Установите флаги напротив тех операций, которые должны фиксироваться в журнале. Название операции соответствуют действию, выполняемому серверной частью системы {dv}.
include::partial$excerpts.adoc[tags=restart]

[#application-log]
== Сообщения журнала приложений

В журнале приложений фиксируются события от различных приложений {dv}. Если установлено несколько приложений, они будут хранить свои сообщения в одном журнале. Порядок получения сообщений от разных приложений не регламентирован, запись сообщений производится в порядке поступления.

Данный журнал -- вспомогательный и используется для хранения полного списка полученных сообщений. При работе с системой сообщения данного журнала фиксируются в журналах конкретных приложений. Также определённые наборы сообщений отображаются в специализированных журналах. Специализированные журналы -- это, например, "Журнал" в карточке _Задание_ или "Журнал подписей" в карточке _Документ_ в {wincl}е или {wc}е.

[NOTE]
====
В системном журнале и журнале приложений может встречаться ошибка `Unexpected error: The file '/docsvision/StorageServer/Fetch.aspx' does not exist.`

Ошибка возникает из-за наличия модуля _Конструктор отчетов_, несовместимого с {dv} версии 5.5. В будущем обработка запросов от данного модуля будет отключена.
====

Журналирование управляется настройкой `LogStrategy`, имеющей три варианта:

* Nothing (`0`) -- журнал не ведётся.
* Filtered (`1`) -- в журнал записывается только то, что указано в настройках журналирования.
* Everything (`2`) -- в журнал записывается всё, настройки игнорируются.

Проверить текущую установленную настройку можно SQL-запросом к базе:

[source,sql]
----
SELECT LogStrategy FROM [dvsys_globalinfo]
----

.В журнале фиксируются следующие операции:
Системные карточки::
Действия с системными карточками.

Открытие карточки:::
Открытие системной карточки.

{bo}::
Действия с карточками модуля _{bo}_.

Сотрудник заблокирован:::
Заполнение периода блокирования сотрудника в _Карточке сотрудника_.

Просмотр истории:::
Просмотр истории на вкладке _История_ карточки _Документ_.

Создание карточки:::
Создание карточки в библиотеке базовых объектов.

Закрытие карточки:::
Закрытие карточки в библиотеке базовых объектов.

Редактирование:::
Изменение ранее заполненного значения поля в карточке библиотеки базовых объектов.

Просмотр журнал подписей:::
Просмотр журнала подписей в карточке _Документ_.

Сохранение карточки:::
Сохранение карточки в библиотеке базовых объектов.

Просмотр ссылки:::
Открытие или переход по ссылке, расположенной в элементе разметки _Ссылки_. Элемент может располагаться как в карточке _Документ_, так и в карточке _Задание_.

Остановка бизнес-процесса:::
Остановка бизнес-процесса из карточки _Документ_ или _Задание_.

Добавление основного файла:::
Добавление основного файла в элементе `_Файлы_` карточки _Документ_.

Чтение основного файла:::
Предварительный просмотр или обращение к данным основного файла в карточке _Документ_.

Редактирование основного файла:::
Открытие основного файла из карточки _Документ_ в соответствующем приложении.

Длительная блокировка основного файла:::
Длительная блокировка основного файла карточки _Документ_.

Удаление основного файла:::
Удаление основного файла в элементе `_Файлы_` карточки _Документ_.

Создание новой версии основного файла:::
Добавление новой версии основного файла на вкладке _Версии_ карточки _Документ_.

Сохранение изменений в текущую версию основного файла:::
Сохранение изменённого файла без изменения версии на вкладке _Версии_ карточки _Документ_.

Смена текущей версии основного файла:::
Смена номера версии основного файла на вкладке _Версии_ карточки _Документ_.

Добавление комментария к версии основного файла:::
Добавление комментария на вкладке _Версии_ карточки _Документ_.

Удаление старой версии основного файла:::
Удаление версии основного файла на вкладке _Версии_ карточки _Документ_.

Добавление дополнительного файла:::
Добавление основного файла в элементе _Файлы_ карточки _Документ_.

Чтение дополнительного файла:::
Предварительный просмотр и обращение к данным дополнительного файла в карточке _Документ_.

Удаление дополнительного файла:::
Удаление основного файла в элементе `_Файлы_` карточки _Документ_.

Подписание документа:::
Добавление подписи к документу в карточке _Документ_.

Отправка документа по электронной почте:::
Результат экспорта данных из карточки _Документ_ через диалог _Отправка по электронной почте_.

Экспорт документа:::
Результат экспорта данных из карточки _Документ_ через диалог _Экспорт_.

Печать документа:::
Результат экспорта данных из карточки _Документ_ через диалог _Печать_.

Назначение категории:::
Добавление новой категории в _Справочник категорий_.

Удаление категории:::
Удаление категории из _Справочника категорий_.

Синхронизация свойств из файла:::
Заполнение атрибутов карточки _Документ_ на основе свойств приложенного основного файла.

Синхронизация свойств в файл:::
Заполнение свойств приложенного основного файла на основе атрибутов карточки _Документ_.

Снятие блокировки файла:::
Снятие блокировки файла в карточке _Документ_.

Отмена блокировки файла:::
Отмена блокировки файла в карточке _Документ_.

Редактирование комментария к файлу:::
Редактирование комментария к файлу в карточке _Документ_.

Удаление комментария к файлу:::
Удаление комментария к файлу в карточке _Документ_.

Отправить:::
Выполнение операции _Отправить_ в карточке _Задание_.

Вернуть на подготовку:::
Выполнение операции _Вернуть на подготовку_ в карточке _Задание_.

Отозвать:::
Выполнение операции _Отозвать_ в карточке _Задание_.

Отклонить:::
Выполнение операции _Отклонить_ в карточке _Задание_.

Отложить:::
Выполнение операции _Отложить_ в карточке _Задание_.

В работу:::
Выполнение операции _В работу_ в карточке _Задание_.

Делегировать:::
Выполнение операции _Делегировать_ в карточке _Задание_.

Отменить делегирование:::
Выполнение операции _Отменить делегирование_ в карточке _Задание_.

Вернуть в "не начато":::
Выполнение операции _Вернуть в "не начато"_ в карточке _Задание_.

Завершить:::
Выполнение операции _Завершить_ в карточке _Задание_.

Прекратить исполнение:::
Выполнение операции _Прекратить исполнение_ в карточке _Задание_.

Изменение срока исполнения:::
Изменение сроков исполнения в карточке _Задание_.

На доработку:::
Выполнение операции _На доработку_ в карточке _Задание_.

Принять:::
Выполнение операции _Принять_ в карточке _Задание_.

Редактирование автора:::
Редактирование поля _Автор_ в карточке _Задание_.

Редактирование содержания:::
Редактирование поля _Содержание_ в карточке _Задание_.

Выбор исполнителя:::
выбор значения в поле _Исполнитель_ в карточке _Задание_.

Изменение текущего исполнителя:::
Редактирование поля _Исполнитель_ в карточке _Задание_.

Установить важность:::
выбор значения поля _Важность_ в карточке _Задание_.

Ввод новых сроков:::
Редактирование дат в области _Сроки_ в карточке _Задание_.

Редактирование напоминаний:::
Редактирование полей _Напомнить за_, _Дата напоминания_ в карточке _Задание_.

Редактирование параметров контроля:::
Редактирование полей _Поставить на контроль_, _Требуется приёмка_, _Дата контроля_, _Контролёр_ в карточке _Задание_.

Редактирование фактических параметров исполнения:::
Редактирование полей _Поставить на контроль_, _Требуется приёмка_, _Дата контроля_, _Контролёр_ в карточке _Задание_.

Добавление комментария:::
Добавление любого комментария.

Изменение или удаление любого комментария:::
удаление любого ранее добавленного комментария.

Изменение или удаление только собственного комментария:::
изменение и удаление любого собственного комментария.

Добавление основного документа:::
Добавление вложенной карточки _Документ_ в карточку _Задание_.

Удаление основного документа:::
удаление вложенной карточки Документ из карточки _Задание_.

Добавление дополнения:::
операция приложения _{dm}_.

Удаление дополнения:::
операция приложения _{dm}_.

Добавление отчёта:::
Добавление отчёта при завершении задания карточки _Задание_.

Удаление отчёта:::
удаление отчёта при завершении задания карточки _Задание_.

Создание подчиненного задания:::
Добавление связанного задания в карточку в элементе _Дерево исполнения_ карточки _Задание_.

Копирование подчиненного задания:::
Копирование связанного задания в элементе _Дерево исполнения_ карточки _Задание_.

Удаление подчиненного задания:::
удаление связанного задания в элементе _Дерево исполнения_ карточки _Задание_.

Просмотр комментария задания:::
Просмотр добавленного комментария из карточки _Задание_.

Просмотр всех комментариев задания:::
Просмотр всех комментариев в карточке _Задание_.

[#set-up]
=== Настройка журнала приложений

.Чтобы настроить журнал приложений, выполните следующие действия:
. В области _Категории_ выберите ветку menu:Настройки журнала[Приложение].
+
В центральной части окна будет расположено дерево операций, доступных для протоколирования в журнале приложений.
+
.Настройки сообщений журнала приложений
image::logs-application.png[Настройки сообщений журнала приложений]
+
. Установите флаги напротив тех операций, которые должны фиксироваться в журнале. Название операции соответствуют действию, выполняемому серверной частью системы {dv}.
+
****
По умолчанию в список операций включены блокирование работы сотрудника в системе и открытие карточки. Остальные протоколируемые операции создаются разработчиками приложения в Card Manager (описываются в схеме библиотеки). Допускается расширение стандартного перечня другими операциями, необходимыми пользователям системы.
****
+
include::partial$excerpts.adoc[tags=restart]
